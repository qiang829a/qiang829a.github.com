<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>发起红包</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<meta name="format-detection" content="telephone=no">
	<meta name="format-detection" content="email=no">
	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/index.css">
</head>
<body class="white-bg">
	<div class="nav-bar">
		<a class="nav-back" href="javascript:;"></a>
		<h1>拼手气</h1>
	</div>
	<div class="spons-task padding-t">
		<div class="inp">
			<span class="spons-title">主题</span>
			<input class="spons-val" type="text" placeholder="拼手气任务">
		</div>
		<div class="inp">
			<span class="spons-title">总人数</span>
			<input class="spons-val" data-person="person" type="text" placeholder="包括自己，最多50人" pattern="[0-9]*">
		</div>
		<div class="inp">
			<span class="spons-title">每人支付</span>
			<input class="spons-val" data-person="mony" type="text" placeholder="至少1元" pattern="[0-9]*">
		</div>
		<button class="spons-btn">发起红包</button>
		<p class="refund-explain">24小时内任务未完成，自动退款</p>
	</div>
	<div class="m-layer">
		<div class="layer-box"></div>
		<div class="popup-def white-bg open_number">
			<strong>支付拼红包</strong>
			<p>您的当前余额为0.27元，不够参与当前活动，请点击支付宝支付参加</p>
			<div class="popup-def-btn">
				<a class="cancel" href="javascript:;">取消支付</a>
				<a class="zhifubao-pay" href="javascript:;">支付宝支付</a>
			</div>
		</div>
	</div>
	<script src="js/zepto.min.js" type="text/javascript"></script>
	<script src="js/common.js" type="text/javascript"></script>
	<script>
		(function(){
			var DATA = {
				sponsRed: function(personNum,mony){
					// $('.common_popup').remove();
					$('.popup-def,.m-layer').addClass('show');
				},
			},
			order = {
				init: function(){
					// 校验输入框 
					this.testInput();
					// 发起红包
					this.sponsRed();
					// 取消订单
					this.popupHide();

				},

				// 校验输入框  
				testInput: function(){
					$('.spons-task input').on('keyup',function(){
						var v1 = parseInt($('.spons-task input').eq(1).val()),
							v2 = parseInt($('.spons-task input').eq(2).val());

						if((v1 <= 50 && v1 >= 2) && (v2 >= 1)){
							$('.spons-task .spons-btn').addClass('on');
						}else{
							$('.spons-task .spons-btn').removeClass('on');
						}
					});

					$('.spons-task input').on('blur',function(){
						if($(this).attr('data-person') || $(this).attr('data-mony')){
							if(!isNaN(parseInt($(this).val()))){
								$(this).val(Math.round(parseInt($(this).val())));
							}
						}
					});
				},

				// 发起红包
				sponsRed: function(){
					common.isMove($('.spons-task .spons-btn'),function(){
						var v1 = parseInt($('.spons-task input').eq(1).val()),
							v2 = parseInt($('.spons-task input').eq(2).val());
							
						if((v1 > 50 || v1 < 2) || isNaN(v1) || isNaN(v2) || (v2 < 1)){
							v1 < 2 && common.PopupText('人数最少2位',true);
							v1 > 50 && common.PopupText('人数最多50位',true);
							v2 < 1 && common.PopupText('至少1元',true);
							isNaN(v1) && common.PopupText('输入有误，请重新输入',true);
						}else{
							common.loadingText('发起中，请稍后');
							DATA.sponsRed(v1,v2);
						}
					});
				},

				popupHide: function(){
					common.isMove($('.popup-def .cancel'),function(){
						$('.popup-def,.m-layer').removeClass('show');
					});
				},
			};
			order.init();
		})();
	</script>
</body>
</html>